---
order: 40
---

# Перекладчик

Перекладчик - это программное обеспечение (далее ПО), предназначенное для переноса файлов из системы клиента в файловый шлюз (далее ФШ) и обратно.

## ЮКБ

[Установка](#install_ucb) <br>
[Структура файловой системы](#structure_ucb) <br>
[Механика работы](#work_ucb) <br>

## Росбанк

[Установка](#install_rb) <br>
[Структура файловой системы](#structure_rb) <br>
[Механика работы](#work_rb) <br>

---

### Установка для ЮКБ {#install_ucb}

Для установки Перекладчика необходимо совершить следующие действия:

1. Получить дистрибутив Перекладчика у специалистов Отдела продаж НРД.

2. Запустить SFTP-сервер. Например, [Rebex](https://www.rebex.net/total-pack/download.aspx) (см. Рисунок 1).

![](/images/perekladchik/server.png "Рисунок 1")

3. Запустить командную строку под администратором: _Меню Пуск -> Поиск -> cmd -> Запуск от имени администратора_ (см. Рисунок 2).

![](/images/perekladchik/cmd.png "Рисунок 2")

4. В командной строке перейти в каталог, в котором находится Перекладчик, при помощи команды `cd` (например, `cd C:\Temp\FileTransferUCB`). Затем ввести команду для инициализации конфигурации: `filetransferucb.exe init`(см. Рисунок 3).

![](/images/perekladchik/init.png "Рисунок 3")

5. В командной строке необходимо ввести следующие параметры для подключения к SFTP-серверу (см. Рисунок 4):
   - `SSH host` - хост
   - `SSH username` - имя пользователя
   - `SSH password` - пароль
   - `SSH private key file path` - папка, в которой хранится ключ
   - `SSH private key passphrase` - пароль ключа
   - `ABS directory` - папка АБС
   - `ABS file mask` - маска файла АБС
   - `FileGateway inbox directory` - папка для входящих файлов, документов
   - `FileGateway outbox directory` - папка для исходящих файлов, документов
   - `Processed files directory` - папка-хранилище для пришедших файлов, документов

![](/images/perekladchik/parametr.png "Рисунок 4")

_ПО Перекладчик можно использовать без ключей, только с логином и паролем. Для этого необходимо не заполнять соответствующие параметры при инициализации конфигурации. Если файл конфигурации уже сгенерирован, следует удалить параметры `private key file path` и `private key passphrase` в `config.json`._

6. В результате будет сгенерирован файл `config.json`, в котором можно изменить параметры (см. Рисунок 5).

![](/images/perekladchik/config.png "Рисунок 5")

7. В командной строке ввести команду `filetransferucb.exe install-service` для установки Перекладчика (см. Рисунок 6).

![](/images/perekladchik/install.png "Рисунок 6")

8. После установки необходимо убедиться, что служба установлена: _Меню Пуск -> Поиск -> Службы_ (см. Рисунок 7).

![](/images/perekladchik/sluzhba.png "Рисунок 7")

9. После установки необходимо создать для каждого клиента папки со следующей структурой (см. Рисунок 8):
   - ../clients/`номер_клиента`/`номер_клиента` - для входящих документов;
   - ../clients/`номер_клиента`/imbkrumm - для исходящих документов.

![](/images/perekladchik/clients.png "Рисунок 8")

10. При подключении ФШ к ПО необходимо в настройках ФШ указать путь к рабочей папке `fgate` (см. Рисунок 9).

![](/images/perekladchik/fsh.png "Рисунок 9")

11. В результате в папке `fgate` будут созданы папки ФШ (см. Рисунок 10).

![](/images/perekladchik/fsh1.png "Рисунок 10")

### Структура файловой системы (ЮКБ) {#structure_ucb}

В папке Перекладчика -> UCB находятся папки `fgate` и `ft` (см. Рисунок 11).

![](/images/perekladchik/fgateft.png "Рисунок 11")

Папка `fgate` предназначена для файлов ФШ и содержит в себе структуру папок ФШ:

- `ERRORS` - служит хранилищем для ошибочных файлов, некорректно принятых или отправленных.
- `inbox` - служит для получения файлов по Onyx от клиентов (платежные поручения, запросы на выписки). Файлы будут приходить в соответствующей структуре – два файла и две подписи.
- `outbox` - служит для отправки файлов клиентам (статусов по платежным поручениям, выписок).
- `REPCLIENTS` - служит для загрузки списка репозитарных участников в формате `.xml`, `.csv`.
- `SENT` - служит хранилищем для отправленных файлов из `outbox`.

Папка `ft` служит хранилищем для пришедших файлов, то есть когда приходит файл в папку ФШ `inbox` он автоматически перекладывается в папку `ft`.

Банк работает с папкой на стороне сервера `data`, в которой создана папка `clients`, а в ней папки по `номеру клиента` (соответствие деп.кода и кода клиента задается в файле `config.json` ПО). Внутри каждой папки по `номеру клиента` есть еще две папки `номер клиента` и `imbkrumm` (см. Рисунок 12).

![](/images/perekladchik/bankfolder.png "Рисунок 12")

В папку с `номером клиента` автоматически приходит файл поручение в формате `.xml`, для загрузки в АБС.
В папку `imbkrumm` должны выкладываться файлы-статусы и выписки для отправки клиенту.
Файлы `winf.xml` создаются автоматически Перекладчиком при переносе файлов из `imbkrumm` в `outbox` ФШ.

### Механика работы (ЮКБ) {#work_ucb}

Пример движения Платежного поручение (ПП) по папкам:

1. ПП приходит от клиента по Onyx в ФШ в папку `inbox`.
2. ПО Перекладчик перекладывает все содержимое папки в папку `ft` и отбирает файл `\*.xml`.
3. Затем Перекладчик перекладывает файл `\*.xml` в папку для АБС по соответствию код клиента = деп.код. Также, автоматически, в папку `outbox` выкладывается файл-квитанция о получении пакета для отправки на адрес клиента.
4. Из папки с `номером клиента` файл загружается в АБС (в АБС происходят различные проверки и по результатам могут выкладываться промежуточные статусы в папку `imbkrumm`: Принято, Проверены реквизиты и прочие).
5. Когда АБС генерирует финальный статус, он также выкладывается в папку `imbkrumm`.
6. ПО Перекладчик автоматически перекладывает файл с финальным статусом в папку для отправки (`outbox`) ФШ, генерируя к нему файл `winf.xml`.

Аналогичным образом происходит работа с выписками и запросами на выписку.

На рисунке 13 отображена таблица с сутью процесса и папками, в которые попадает файл.  
_fg = `fgate`, in = `номер клиента`, out = `imbkrumm`_

![](/images/perekladchik/table.png "Рисунок 13")

---

### Установка для Росбанка {#install_rb}

Для установки Перекладчика необходимо совершить следующие действия:

1. Получить дистрибутив Перекладчика у специалистов Отдела продаж НРД.
2. Изменить параметры в файле конфигурации `FileTransfer.exe.config`, если необходимо (см. Рисунок 14).
   По умолчанию прописаны следующие параметры:

   - Путь к директории INBOX Файлового шлюза: `c:\Temp\RB\fgate\inbox`
   - Путь к директории OUTBOX Файлового шлюза: `c:\Temp\RB\fgate\outbox`
   - Путь к директории для входящих в АБС файлов: `c:\Temp\RB\abs`
   - Фильтр для исходящих из АБС файлов: `*.enc`
   - Путь к директории с обработанными входящими файлами: `c:\Temp\RB\ft\prcsd`

![](/images/perekladchik/FileTransfer.exe.config.png "Рисунок 14")

3. Запустить файл `FileTransfer.exe` для установки ПО (см. Рисунок 15).

![](/images/perekladchik/rb_cmd.png "Рисунок 15")

4. После установки в папке по умолчанию `С:\Temp\RB` появятся указанные в файле конфигурации директории (см. Рисунок 16).

![](/images/perekladchik/rb_distributive.png "Рисунок 16")

5. При подключении ФШ к ПО необходимо в настройках ФШ указать путь к рабочей папке `fgate` (см. Рисунок 17).

![](/images/perekladchik/fsh.png "Рисунок 17")

11. В результате в папке `fgate` будут созданы папки ФШ (см. Рисунок 18).

![](/images/perekladchik/fsh1.png "Рисунок 18")

### Структура файловой системы (Росбанк) {#structure_rb}

В папке Перекладчика -> RB находятся папки `abs`, `fgate`, `ft`, `logs` (см. Рисунок 19).

![](/images/perekladchik/rb_distributive.png "Рисунок 19")

Банк работает с папкой `abs`, в которой созданы папки по `номеру клиента` (соответствие деп.кода и кода клиента задается в файле `FileTransfer.exe.config` ПО). Внутри каждой папки по `номеру клиента` есть еще две папки `номер клиента` и `OUT` (см. Рисунок 20).

![](/images/perekladchik/abs.png "Рисунок 20")

В папку с `номером клиента` автоматически приходит файл поручение в формате `.xml`, для загрузки в АБС.
В папку `OUT` должны выкладываться файлы-статусы и выписки для отправки клиенту.
Файлы `winf.xml` создаются автоматически Перекладчиком при переносе файлов из `OUT` в `outbox` ФШ.

Папка `fgate` предназначена для файлов ФШ и содержит в себе структуру папок ФШ:

- `ERRORS` - служит хранилищем для ошибочных файлов, некорректно принятых или отправленных.
- `inbox` - служит для получения файлов по Onyx от клиентов (платежные поручения, запросы на выписки). Файлы будут приходить в соответствующей структуре – два файла и две подписи.
- `outbox` - служит для отправки файлов клиентам (статусов по платежным поручениям, выписок).
- `REPCLIENTS` - служит для загрузки списка репозитарных участников в формате `.xml`, `.csv`.
- `SENT` - служит хранилищем для отправленных файлов из `outbox`.

Папка `ft` служит хранилищем для пришедших файлов, то есть когда приходит файл в папку ФШ `inbox` он автоматически перекладывается в папку `ft\prcsd`.

Папка `logs` служит хранилищем для лог-файлов.

### Механика работы (Росбанк) {#work_rb}

Пример движения Платежного поручение (ПП) по папкам:

1. ПП приходит от клиента по Onyx в ФШ в папку `inbox`.
2. ПО Перекладчик перекладывает все содержимое папки в папку `ft\prcsd` и отбирает файл `\*.xml`.
3. Затем Перекладчик перекладывает файл `\*.xml` в папку для АБС `abs\номер_клиента` по соответствию код клиента = деп.код. Также, автоматически, в папку `outbox` выкладывается файл-квитанция о получении пакета для отправки на адрес клиента.
4. Из папки с `номером клиента` файл загружается в АБС (в АБС происходят различные проверки и по результатам могут выкладываться промежуточные статусы в папку `OUT`: Принято, Проверены реквизиты и прочие).
5. Когда АБС генерирует финальный статус, он также выкладывается в папку `OUT`.
6. ПО Перекладчик автоматически перекладывает файл с финальным статусом в папку для отправки (`outbox`) ФШ, генерируя к нему файл `winf.xml`.

Аналогичным образом происходит работа с выписками и запросами на выписку.

На рисунке 21 отображена таблица с сутью процесса и папками, в которые попадает файл.  
_fg = `fgate`, cc = `номер клиента`, in = `номер клиента`, out = `OUT`_

![](/images/perekladchik/table.png "Рисунок 21")
